# grove fetch: backward commit count (rollback)

mkdir origin
exec git init --bare origin

mkdir source
exec git init source
cd source
exec git config user.name "Test"
exec git config user.email "test@example.com"
exec git config commit.gpgsign false
cp ../README.md .
exec git add .
exec git commit -m 'initial commit'
exec git remote add origin ../origin
exec git push -u origin main
cd ..

mkdir workspace
exec grove clone file://$WORK/origin workspace
cd workspace/main
exec git config user.name "Test"
exec git config user.email "test@example.com"

# Add multiple commits to main
cd $WORK/source
cp $WORK/readme-a.md README.md
exec git add .
exec git commit -m 'commit a'
cp $WORK/readme-b.md README.md
exec git add .
exec git commit -m 'commit b'
exec git push origin main

# Fetch to sync
cd $WORK/workspace/main
exec grove fetch
stdout '\+2 commits'

# Now rollback on origin (force push to earlier commit)
cd $WORK/source
exec git reset --hard HEAD~2
exec git push --force origin main

# Fetch should show negative commit count
cd $WORK/workspace/main
exec grove fetch
stdout 'origin:'
stdout '\* main'
stdout '-2 commits'

-- README.md --
# Test

-- readme-a.md --
# Test
a

-- readme-b.md --
# Test
a
b
