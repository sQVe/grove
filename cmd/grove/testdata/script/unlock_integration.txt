# Create grove workspace via clone
mkdir testrepo
exec git init testrepo
cd testrepo
exec git config user.name "Test"
exec git config user.email "test@example.com"
exec git config commit.gpgsign false
cp ../README.md .
exec git add .
exec git commit -m 'initial commit'
exec git checkout -b feature
exec git checkout main
cd ..

mkdir workspace
exec grove clone file://$WORK/testrepo workspace
cd workspace/main
exec git config user.name "Test"
exec git config user.email "test@example.com"

# Setup: Add and lock a worktree
exec grove add feature
! stderr .
exec grove lock feature --reason 'Testing'
! stderr .

## Verify locked (precondition for unlock test)

exec grove list --verbose
stdout 'locked'
! stderr .

## Unlock worktree

exec grove unlock feature
stdout 'Unlocked worktree'
! stderr .

## Verify unlocked
# Use --json for reliable machine-readable check

cd ../feature
exec grove status --json
stdout '"locked": false'
! stderr .
cd ../main

## Error: already unlocked

! exec grove unlock feature
stderr '^✗ worktree is not locked'

## Error: worktree not found

! exec grove unlock nonexistent
stderr '^✗ worktree not found: nonexistent'

## Error: not in workspace

cd /tmp
! exec grove unlock feature
stderr '^✗ not in a grove workspace'

-- README.md --
# Test
