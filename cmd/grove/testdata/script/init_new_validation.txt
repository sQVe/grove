# grove init new validation tests
# Tests init new argument parsing and pre-condition validation

## Help output

# --help shows usage
exec grove init new --help
stdout 'Create a new grove workspace'
stdout 'Usage:'
stdout '[directory]'
! stderr .

## Argument validation

# Too many arguments
! exec grove init new dir1 dir2
stderr '^✗ accepts at most 1 arg'
stderr 'received 2'

## Pre-condition validation

# Directory not empty
mkdir new-fails-not-empty
cp existing.txt new-fails-not-empty/existing.txt
! exec grove init new new-fails-not-empty
stderr '^✗ directory.*new-fails-not-empty.*not empty'

# Inside existing grove workspace
mkdir new-fails-inside-grove
exec grove init new new-fails-inside-grove
! stderr .
cd new-fails-inside-grove
! exec grove init new
stderr '^✗ cannot initialize grove inside existing grove workspace'
cd ..

# Nested inside existing grove workspace
mkdir new-fails-nested-grove
exec grove init new new-fails-nested-grove
! stderr .
! exec grove init new new-fails-nested-grove/nested
stderr '^✗ cannot initialize grove inside existing grove workspace'

-- existing.txt --
content