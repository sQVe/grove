# grove doctor: detect stale worktree entry with relative path

# Setup: Create workspace via clone
mkdir testrepo
exec git init testrepo
cd testrepo
exec git config user.name "Test"
exec git config user.email "test@example.com"
exec git config commit.gpgsign false
cp ../README.md .
exec git add .
exec git commit -m 'initial commit'
cd ..

mkdir workspace
exec grove clone file://$WORK/testrepo workspace
cd workspace/main
exec git config user.name "Test"
exec git config user.email "test@example.com"

mkdir ../.bare/worktrees/orphan-relative
cp $WORK/orphan-relative-gitdir ../.bare/worktrees/orphan-relative/gitdir

! exec grove doctor
stdout 'Git Issues'
stdout 'âœ— Stale worktree entry'
stdout 'orphan-relative'

-- README.md --
# Test fixture

-- orphan-relative-gitdir --
../../nonexistent-worktree/.git
