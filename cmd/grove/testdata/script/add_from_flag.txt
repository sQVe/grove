# Test: grove add --from specifies source worktree for preservation
setup_workspace

# Add a unique preserve pattern and gitignore
exec sh -c 'echo ".env.from-test" >> .gitignore'
exec git add .gitignore
exec git commit -m 'add from-test gitignore'
exec git config --add grove.preserve .env.from-test

# Create another worktree to use as source
exec grove add --base main feature/alt-source-2

# Create unique content in alt-source worktree
exec sh -c 'echo "FROM_FLAG_TEST=from-alt" > ../feature-alt-source-2/.env.from-test'

# Create different content in main worktree
exec sh -c 'echo "FROM_FLAG_TEST=from-main" > .env.from-test'

# Create worktree from workspace root with --from pointing to alt-source
cd $WORK/workspace
exec grove add --from feature-alt-source-2 feature/from-flag-test
stderr 'Created worktree at .*[/\\]feature-from-flag-test'
stderr 'preserved'
stderr '.env.from-test'

# Verify file came from alt-source (not main)
exists feature-from-flag-test/.env.from-test
exec sh -c 'cat feature-from-flag-test/.env.from-test'
stdout 'from-alt'

# Cleanup git config
cd $WORK/workspace/main
exec git config --unset grove.preserve
