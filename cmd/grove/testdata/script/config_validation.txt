# grove config validation tests
# Tests config command argument parsing and validation

## Help output

exec grove config --help
stdout 'Usage:'
stdout 'list'
stdout 'get'
stdout 'set'
stdout 'unset'
! stderr .

# No subcommand shows help
exec grove config
stdout 'Usage:'
! stderr .

## Argument validation

# Invalid subcommand
! exec grove config invalid
stderr '✗ unknown command "invalid" for "grove config"'

# list rejects extra arguments
! exec grove config list extra
stderr '✗ unknown command "extra" for "grove config list"'

# get requires key
! exec grove config get
stderr '✗ accepts 1 arg'
stderr 'received 0'

# set requires key and value
! exec grove config set --global key
stderr '✗ accepts 2 arg'
stderr 'received 1'

# unset requires key
! exec grove config unset --global
stderr '✗ accepts between 1 and 2 arg'
stderr 'received 0'

## Scope validation

# set requires --shared or --global
! exec grove config set grove.plain true
stderr '✗ must specify --shared or --global'

# --shared and --global conflict
! exec grove config set --shared --global grove.plain true
stderr '✗ --shared and --global cannot be used together'

## Key validation

# non-grove.* keys rejected - get
! exec grove config get --global user.name
stderr '✗ only grove\.\* settings'

# non-grove.* keys rejected - set
! exec grove config set --global user.name value
stderr '✗ only grove\.\* settings'

# non-grove.* keys rejected - unset
! exec grove config unset --global user.name
stderr '✗ only grove\.\* settings'

## Value validation

# boolean validation for grove.plain
! exec grove config set --global grove.plain maybe
stderr '✗ invalid boolean'

# boolean validation for grove.debug
! exec grove config set --global grove.debug 2
stderr '✗ invalid boolean'

## Global operations

# set/get/list work
exec grove config set --global grove.plain true
! stderr .
exec grove config get --global grove.plain
stdout '^true$'
! stderr .

exec grove config list --global
stdout 'grove.plain=true'
! stderr .

# case-insensitive keys
exec grove config set --global grove.PLAIN true
! stderr .
# Key is normalized to lowercase
exec grove config get --global grove.plain
stdout '^true$'
! stderr .

## Cleanup

# Clean up global config
exec grove config unset --global grove.plain
! stderr .
