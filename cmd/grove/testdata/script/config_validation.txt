# Test config command help
exec grove config --help
stdout 'Usage:'
stdout 'list'
stdout 'get'
stdout 'set'
stdout 'unset'
! stderr .

# Test config command execution shows help
exec grove config
stdout 'Usage:'
! stderr .

# Test config rejects invalid subcommands
! exec grove config invalid
stderr 'unknown command "invalid" for "grove config"'

# Test argument validation - list rejects extra arguments
! exec grove config list extra
stderr 'unknown command "extra" for "grove config list"'

# Test argument validation - get requires key
! exec grove config get
stderr 'accepts 1 arg'
stderr 'received 0'

# Test argument validation - set requires key and value
! exec grove config set --global key
stderr 'accepts 2 arg'
stderr 'received 1'

# Test argument validation - unset requires key
! exec grove config unset --global
stderr 'accepts between 1 and 2 arg'
stderr 'received 0'

# Test set requires --shared or --global
! exec grove config set grove.plain true
stderr 'must specify --shared or --global'

# Test --shared and --global cannot be used together
! exec grove config set --shared --global grove.plain true
stderr '--shared and --global cannot be used together'

# Test non-grove.* keys rejected - get
! exec grove config get --global user.name
stderr 'only grove\.\* settings'

# Test non-grove.* keys rejected - set
! exec grove config set --global user.name value
stderr 'only grove\.\* settings'

# Test non-grove.* keys rejected - unset
! exec grove config unset --global user.name
stderr 'only grove\.\* settings'

# Test boolean validation for grove.plain
! exec grove config set --global grove.plain maybe
stderr 'invalid boolean'

# Test boolean validation for grove.debug
! exec grove config set --global grove.debug 2
stderr 'invalid boolean'

# Test global operations work
exec grove config set --global grove.plain true
! stderr .
exec grove config get --global grove.plain
stdout '^true$'
! stderr .

exec grove config list --global
stdout 'grove.plain=true'
! stderr .

# Test case-insensitivity (git config behavior)
exec grove config set --global grove.PLAIN true
! stderr .
# Key is normalized to lowercase
exec grove config get --global grove.plain
stdout '^true$'
! stderr .

# Clean up global config
exec grove config unset --global grove.plain
! stderr .
