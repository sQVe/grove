# Create grove workspace via clone
mkdir testrepo
exec git init testrepo
cd testrepo
# Use repo-local config (not global) to avoid CI conflicts
exec git config user.name "Test"
exec git config user.email "test@example.com"
exec git config commit.gpgsign false
cp ../README.md .
exec git add .
exec git commit -m 'initial commit'
exec git checkout -b develop
cd ..

mkdir workspace
exec grove clone file://$WORK/testrepo workspace --branches main,develop
cd workspace/main
# Set local git config in worktree too
exec git config user.name "Test"
exec git config user.email "test@example.com"

## Basic list tests

# Test basic list shows branches (no dirty indicator when clean)
exec grove list --plain
stdout 'main'
stdout 'develop'
! stdout '\[dirty\]'
! stderr .

# Test list with --fast skips status (no sync indicator shown)
exec grove list --fast --plain
stdout 'main'
stdout 'develop'
! stdout '\[dirty\]'
! stderr .

# Test list with --json
exec grove list --json
stdout '"name":'
stdout '"main"'
stdout '"develop"'
stdout '"path":'
! stderr .

# Test list with --verbose shows path and upstream
exec grove list --verbose
stdout 'main'
stdout 'develop'
stdout 'workspace/main'
! stderr .

## Dirty detection

# Create uncommitted file
cp $WORK/README.md dirty.txt
exec grove list --plain
stdout '\[dirty\]'
! stderr .

# Clean up for next test
rm dirty.txt

## Workspace root behavior

# From workspace root, no branch should be marked as current (we're not in a worktree)
cd $WORK/workspace
exec grove list --plain
stdout 'main'
stdout 'develop'
# No asterisk prefix means no current worktree (we're at workspace root, not in a worktree)
! stdout '^\*'
! stderr .

## Subdirectory handling

# Test list from subdirectory marks correct current worktree
cd $WORK/workspace/main
mkdir -p src/components
cd src/components
exec grove list --plain
# Asterisk prefix marks current worktree
stdout '^\*'
stdout 'main'
! stderr .

## Error handling

# Test not in workspace error
cd /tmp
! exec grove list
stderr '^âœ— not in a grove workspace'

-- README.md --
# Test
