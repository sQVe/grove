# grove init convert - directory hierarchy restoration on rollback
# Tests that directory hierarchy is preserved and restored on rollback

mkdir convert-hierarchy-test
cd convert-hierarchy-test
exec git init
mkdir subdir
mkdir subdir/nested
cp ../test-file.txt subdir/
cp ../test-file.txt subdir/nested/nested-file.txt
exec git add .
exec git commit -m 'initial commit with directory hierarchy'

# Create blocking directory to force rollback
mkdir main
cp $WORK/blocker main/blocker.txt
exec git add .
exec git commit -m 'add blocker'

! exec grove init convert
stderr 'âœ— failed to create worktree'

# Verify directory hierarchy was restored correctly
exists subdir/test-file.txt
exists subdir/nested/nested-file.txt

# Verify .git directory is restored
exists .git
! exists .bare

-- test-file.txt --
This is a test file

-- blocker --
blocking file
