---
phase: 06-error-formatting
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
    - cmd/grove/commands/add.go
    - cmd/grove/commands/remove.go
    - cmd/grove/commands/lock.go
    - cmd/grove/commands/move.go
autonomous: true

must_haves:
    truths:
        - 'Worktree already exists error suggests using existing worktree or different name'
        - 'Cannot delete current worktree error suggests switching first'
        - 'Already locked error suggests grove unlock command'
        - 'Cannot rename current worktree error suggests switching first'
    artifacts:
        - path: 'cmd/grove/commands/add.go'
          provides: 'HINT-01: worktree exists hint'
          contains: 'grove list'
        - path: 'cmd/grove/commands/remove.go'
          provides: 'HINT-02: cannot delete current hint'
          contains: 'grove switch'
        - path: 'cmd/grove/commands/lock.go'
          provides: 'HINT-03: already locked hint'
          contains: 'grove unlock'
        - path: 'cmd/grove/commands/move.go'
          provides: 'HINT-04: cannot rename current hint'
          contains: 'grove switch'
    key_links:
        - from: 'cmd/grove/commands/add.go'
          to: 'logger.Error or fmt.Errorf'
          via: 'error return with multiline hint'
          pattern: 'Hint:'
        - from: 'cmd/grove/commands/remove.go'
          to: 'logger.Error'
          via: 'error output with hint'
          pattern: 'Hint:'
---

<objective>
Add actionable hints to four common error messages so users know what to do next.

Purpose: When users encounter these errors, they currently get a description of what went wrong but no guidance on how to fix it. Adding hints improves the CLI experience by suggesting the next command to run.

Output: Four command files updated with inline hints in error messages.
</objective>

<execution_context>
@/home/sqve/.claude/get-shit-done/workflows/execute-plan.md
@/home/sqve/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-error-formatting/06-RESEARCH.md
@cmd/grove/commands/add.go
@cmd/grove/commands/remove.go
@cmd/grove/commands/lock.go
@cmd/grove/commands/move.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add hints to add.go and remove.go errors</name>
  <files>cmd/grove/commands/add.go, cmd/grove/commands/remove.go</files>
  <action>
Update error messages to include actionable hints using multiline format.

**add.go (HINT-01)** - Lines 207 and 355 have the same error pattern:

```go
return fmt.Errorf("worktree already exists for branch %q at %s", branch, info.Path)
```

Change to:

```go
return fmt.Errorf("worktree already exists for branch %q at %s\n\nHint: Use 'grove list' to see existing worktrees, or use --name to choose a different directory", branch, info.Path)
```

**remove.go (HINT-02)** - Line 115:

```go
logger.Error("%s: cannot delete current worktree", displayName)
```

Change to:

```go
logger.Error("%s: cannot delete current worktree\n\nHint: Switch to a different worktree first with 'grove switch <worktree>'", displayName)
```

  </action>
  <verify>
Run `make lint` to verify no syntax errors.
Manually test: from inside a worktree, run `grove remove <current-worktree>` and verify hint appears.
  </verify>
  <done>
- add.go error at line 207 includes hint about grove list and --name
- add.go error at line 355 (PR flow) includes same hint
- remove.go error at line 115 includes hint about grove switch
  </done>
</task>

<task type="auto">
  <name>Task 2: Add hints to lock.go and move.go errors</name>
  <files>cmd/grove/commands/lock.go, cmd/grove/commands/move.go</files>
  <action>
Update error messages to include actionable hints.

**lock.go (HINT-03)** - Lines 96-98 have two variants:

```go
logger.Error("%s: already locked (%q)", info.Branch, existingReason)
// and
logger.Error("%s: already locked", info.Branch)
```

Change to:

```go
logger.Error("%s: already locked (%q)\n\nHint: Use 'grove unlock %s' to remove the lock", info.Branch, existingReason, info.Branch)
// and
logger.Error("%s: already locked\n\nHint: Use 'grove unlock %s' to remove the lock", info.Branch, info.Branch)
```

**move.go (HINT-04)** - Line 73 already has a partial hint:

```go
return fmt.Errorf("cannot rename current worktree; switch to a different worktree first")
```

Change to match the hint format:

```go
return fmt.Errorf("cannot rename current worktree\n\nHint: Switch to a different worktree first with 'grove switch <worktree>'")
```

  </action>
  <verify>
Run `make lint` to verify no syntax errors.
Run `make test` to ensure no regressions.
  </verify>
  <done>
- lock.go error at lines 96-98 includes hint about grove unlock with specific worktree name
- move.go error at line 73 uses standard hint format with grove switch suggestion
  </done>
</task>

<task type="auto">
  <name>Task 3: Add tests for error hints</name>
  <files>cmd/grove/commands/add_test.go, cmd/grove/commands/remove_test.go, cmd/grove/commands/lock_test.go, cmd/grove/commands/move_test.go</files>
  <action>
Add or update tests to verify hints appear in error messages.

For each command, add a test case that triggers the error condition and verifies the hint text is present.

**Test patterns:**

- HINT-01: Test that adding a branch that already has a worktree returns error containing "grove list" and "--name"
- HINT-02: Test that removing current worktree returns error containing "grove switch"
- HINT-03: Test that locking an already-locked worktree returns error containing "grove unlock"
- HINT-04: Test that moving current worktree returns error containing "grove switch"

Follow existing test patterns in the codebase. If test files don't exist for these commands, check if integration tests exist elsewhere or add minimal unit tests.

Note: Some tests may require test fixtures (mock git repos). Check existing test patterns in cmd/grove/commands/ or internal/ for how tests are structured.
</action>
<verify>
Run `make test` - all tests pass including new hint tests.
</verify>
<done>

- Each hint has at least one test verifying the hint text appears in the error output
- All tests pass
  </done>
  </task>

</tasks>

<verification>
1. `make lint` passes
2. `make test` passes
3. Manual verification of each hint:
   - `grove add <existing-branch>` shows "grove list" and "--name" hint
   - `grove remove <current-worktree>` (from inside) shows "grove switch" hint
   - `grove lock <already-locked>` shows "grove unlock" hint
   - `grove move <current-worktree> newname` shows "grove switch" hint
</verification>

<success_criteria>

- All four HINT requirements (HINT-01 through HINT-04) are implemented
- Error messages follow consistent "Hint: ..." format
- Tests verify hint text appears in error output
- `make ci` passes
  </success_criteria>

<output>
After completion, create `.planning/phases/06-error-formatting/06-01-SUMMARY.md`
</output>
