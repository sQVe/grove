---
phase: 03-foundation
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
    - internal/logger/spinner.go
    - internal/logger/spinner_test.go
autonomous: true

must_haves:
    truths:
        - 'Spinner can be stopped with success indicator (checkmark)'
        - 'Spinner can be stopped with error indicator (X)'
        - 'Spinner message can be updated without flicker'
        - 'Spinner is safe to call Stop() multiple times'
        - 'Plain mode prints message once without animation'
    artifacts:
        - path: 'internal/logger/spinner.go'
          provides: 'Spinner type with Update/Stop/StopWithSuccess/StopWithError'
          exports: ['Spinner', 'StartSpinner']
          min_lines: 60
        - path: 'internal/logger/spinner_test.go'
          provides: 'Spinner behavior tests'
          contains: 'TestSpinner'
    key_links:
        - from: 'internal/logger/spinner.go'
          to: 'internal/logger/logger.go'
          via: 'isPlain() for mode detection'
          pattern: "isPlain\\(\\)"
        - from: 'internal/logger/spinner.go'
          to: 'internal/styles/styles.go'
          via: 'styles.Render for colored output'
          pattern: "styles\\.Render"
---

<objective>
Create a Spinner type that returns from StartSpinner() with methods for message updates and contextual stop indicators.

Purpose: Provides the API foundation for all progress feedback in Grove. The existing func() return type limits callers to just stopping; the new \*Spinner type enables Update(), StopWithSuccess(), and StopWithError().

Output: `internal/logger/spinner.go` with tested Spinner type, `internal/logger/spinner_test.go` with behavior tests.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-foundation/03-RESEARCH.md

@internal/logger/logger.go
@internal/logger/logger_test.go
@internal/styles/styles.go
</context>

<feature>
  <name>Spinner type with enhanced API</name>
  <files>internal/logger/spinner.go, internal/logger/spinner_test.go</files>
  <behavior>
    The Spinner type provides progress feedback for long-running operations.

    API contract:
    - StartSpinner(message) returns *Spinner (not func())
    - spinner.Update(newMessage) changes displayed message atomically
    - spinner.Stop() clears line and stops animation
    - spinner.StopWithSuccess(message) stops and prints success message with checkmark
    - spinner.StopWithError(message) stops and prints error message with X
    - All Stop* methods are idempotent (safe to call multiple times)
    - Plain mode: prints message once, all methods are no-ops

    Test cases:
    - Update() stores new message (verify via atomic.Value)
    - Stop() can be called multiple times without panic
    - StopWithSuccess() prints checkmark in normal mode
    - StopWithError() prints X in normal mode
    - Plain mode: StartSpinner prints message once, returns no-op spinner
    - Plain mode: no ANSI codes in output

  </behavior>
  <implementation>
    Extract spinner logic from logger.go into spinner.go:

    1. Define Spinner struct with:
       - message atomic.Value (string)
       - done chan bool
       - once sync.Once

    2. StartSpinner returns *Spinner:
       - Plain mode: print message, return spinner with closed done channel
       - Normal mode: start goroutine, return spinner

    3. Spinner methods:
       - Update(msg): s.message.Store(msg)
       - Stop(): s.once.Do(func() { close(s.done); sleep(10ms) })
       - StopWithSuccess(msg): s.Stop(); logger.Success(msg)
       - StopWithError(msg): s.Stop(); logger.Error(msg)

    4. Animation goroutine reads message via s.message.Load().(string)

    Follow patterns from 03-RESEARCH.md code examples. Use existing isPlain() from logger.go.

  </implementation>
</feature>

<verification>
- `make test` passes with new spinner tests
- `make lint` passes
- No data races: `go test -race ./internal/logger/...`
</verification>

<success_criteria>

- Spinner type exists with all four methods (Update, Stop, StopWithSuccess, StopWithError)
- Tests cover plain mode and normal mode behavior
- Tests verify idempotent Stop() (no panic on double call)
- No changes to existing StartSpinner callers yet (that's plan 02)
  </success_criteria>

<output>
After completion, create `.planning/phases/03-foundation/03-01-SUMMARY.md`
</output>
