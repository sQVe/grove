---
phase: 05-output-consistency
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
    - cmd/grove/commands/list.go
    - cmd/grove/commands/clone.go
    - cmd/grove/commands/doctor.go
    - cmd/grove/commands/prune.go
autonomous: true

must_haves:
    truths:
        - 'User sees spinner while grove list gathers worktree status'
        - 'User sees spinner during grove clone operation'
        - 'User sees spinner during grove doctor remote checks'
        - 'User sees spinner during grove prune fetch operation'
    artifacts:
        - path: 'cmd/grove/commands/list.go'
          provides: 'Spinner during status gathering'
          contains: 'StartSpinner'
        - path: 'cmd/grove/commands/clone.go'
          provides: 'Spinner during clone operation'
          contains: 'StartSpinner'
        - path: 'cmd/grove/commands/doctor.go'
          provides: 'Spinner during remote reachability checks'
          contains: 'StartSpinner'
        - path: 'cmd/grove/commands/prune.go'
          provides: 'Spinner replaces logger.Info for fetch'
          contains: 'StartSpinner'
    key_links:
        - from: 'cmd/grove/commands/list.go'
          to: 'internal/logger/spinner.go'
          via: 'logger.StartSpinner call'
          pattern: "logger\\.StartSpinner"
---

<objective>
Add spinners to long-running operations in list, clone, doctor, and prune commands.

Purpose: Users see progress feedback during operations that may take several seconds (network operations, status gathering). Replaces static "Fetching..." messages with animated spinners that stop with success/error indicators.

Output: Four command files updated with spinner usage following established patterns from Phase 3/4.
</objective>

<execution_context>
@/home/sqve/.claude/get-shit-done/workflows/execute-plan.md
@/home/sqve/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-output-consistency/05-RESEARCH.md
@internal/logger/spinner.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add spinner to grove list</name>
  <files>cmd/grove/commands/list.go</files>
  <action>
Add spinner to list.go during worktree status gathering.

In runList function, after bareDir validation and before calling git.ListWorktreesWithInfo:

1. Start spinner with "Gathering worktree status..." message
2. After ListWorktreesWithInfo returns, stop spinner (no success message - silent completion)
3. If error, use StopWithError

Pattern from fetch.go:

```go
spin := logger.StartSpinner("Gathering worktree status...")
infos, err := git.ListWorktreesWithInfo(bareDir, fast)
spin.Stop()  // Silent stop for list - we're about to show the list itself
if err != nil {
    return fmt.Errorf("failed to list worktrees: %w", err)
}
```

Note: Use spin.Stop() not StopWithSuccess() since the list output itself shows results. The spinner is for the gathering phase only.

In fast mode, still show spinner but with shorter duration (status checks are faster).
</action>
<verify>
`grove list` shows spinner animation during status gathering in TTY mode.
`grove list --plain` prints "-> Gathering worktree status..." once without animation.
`grove list --fast` also shows spinner (faster but still visible).
</verify>
<done>SPIN-05 satisfied: grove list shows spinner while gathering worktree status</done>
</task>

<task type="auto">
  <name>Task 2: Add spinners to grove clone</name>
  <files>cmd/grove/commands/clone.go</files>
  <action>
Add spinners to clone.go operations. Multiple operations need spinners.

In runCloneFromPR function:

1. Replace `logger.Info("Cloning %s/%s...", ...)` with spinner: `spin := logger.StartSpinner(fmt.Sprintf("Cloning %s/%s...", ref.Owner, ref.Repo))`
2. After gh clone completes, stop spinner (spin.Stop() since we continue with more operations)
3. Replace `logger.Info("Fetching PR #%d...", ref.Number)` with new spinner
4. After FetchPRInfo, stop spinner
5. For fork flow: Replace `logger.Info("Adding remote %s for fork...", remoteName)` and `logger.Info("Fetching branch %s from fork...", branch)` with spinners

In runCloneFromGitHub function:

- The clone itself happens in cloneWithGh which already has spinner usage. No changes needed there.

In cloneWithGh function:

- Already has spinner pattern: `logger.Info("Cloning %s...", repoSpec)` - replace with StartSpinner and Stop after cmd.Run()

Pattern for multi-step:

```go
spin := logger.StartSpinner(fmt.Sprintf("Cloning %s/%s...", ref.Owner, ref.Repo))
if err := cmd.Run(); err != nil {
    spin.StopWithError(fmt.Sprintf("Clone failed"))
    // ... handle error
}
spin.Stop() // Continue to next step
```

  </action>
  <verify>
`grove clone https://github.com/owner/repo` shows spinner during clone.
`grove clone https://github.com/owner/repo/pull/123` shows sequential spinners for clone, fetch PR, and branch operations.
  </verify>
  <done>SPIN-06 satisfied: grove clone shows spinner during clone operation</done>
</task>

<task type="auto">
  <name>Task 3: Add spinner to grove doctor remote checks</name>
  <files>cmd/grove/commands/doctor.go</files>
  <action>
Add spinner during remote reachability checks in detectRemoteIssues function.

The function runs concurrent goroutines to check remotes. Add spinner around the concurrent operation:

```go
func detectRemoteIssues(bareDir string, result *DoctorResult) {
    remotes, err := git.ListRemotes(bareDir)
    if err != nil {
        logger.Debug("Failed to list remotes: %v", err)
        return
    }

    if len(remotes) == 0 {
        return
    }

    spin := logger.StartSpinner("Checking remote connectivity...")

    var (
        wg     sync.WaitGroup
        mu     sync.Mutex
        issues []Issue
    )

    // ... existing goroutine code ...

    wg.Wait()
    spin.Stop()  // Silent stop - results shown in doctor output

    result.Issues = append(result.Issues, issues...)
}
```

Note: spinner.Stop() not StopWithSuccess() because doctor output shows the results. Spinner is just for the waiting period.
</action>
<verify>
`grove doctor` shows spinner during remote reachability checks.
`grove doctor --plain` shows "-> Checking remote connectivity..." once.
</verify>
<done>SPIN-07 satisfied: grove doctor shows spinner during remote reachability checks</done>
</task>

</tasks>

<verification>
All spinner commands verified:
- `make test` passes
- `make lint` passes
- Manual test: `grove list` in workspace shows spinner
- Manual test: `grove doctor` shows spinner during remote checks
- Manual test: `grove prune` shows spinner during fetch
</verification>

<success_criteria>

- [ ] SPIN-05: grove list shows spinner while gathering status
- [ ] SPIN-06: grove clone shows spinner during clone
- [ ] SPIN-07: grove doctor shows spinner during remote checks
- [ ] All tests pass
- [ ] No lint errors
      </success_criteria>

<output>
After completion, create `.planning/phases/05-output-consistency/05-01-SUMMARY.md`
</output>
