---
phase: 05-output-consistency
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
    - cmd/grove/commands/remove.go
    - cmd/grove/commands/prune.go
autonomous: true

must_haves:
    truths:
        - 'User sees full path of deleted worktree in grove remove output'
        - 'User sees spinner with progress count during multi-worktree remove'
        - 'Prune command uses spinner instead of logger.Info for fetch'
    artifacts:
        - path: 'cmd/grove/commands/remove.go'
          provides: 'Full path in success message, spinner for multi-remove'
          contains: 'styles.RenderPath'
        - path: 'cmd/grove/commands/prune.go'
          provides: 'Spinner for fetch operation'
          contains: 'StartSpinner'
    key_links:
        - from: 'cmd/grove/commands/remove.go'
          to: 'internal/styles/styles.go'
          via: 'RenderPath for path display'
          pattern: "styles\\.RenderPath"
---

<objective>
Improve remove command output: show full path of deleted worktrees (fixes #68) and add spinner with progress counter for multi-worktree removal. Also update prune to use spinner for fetch.

Purpose: Users can clearly see which worktree was deleted (full path, not just branch name). Multi-worktree operations show progress. Addresses issue #68 and SPIN-08.

Output: Remove command with improved output, prune command with spinner.
</objective>

<execution_context>
@/home/sqve/.claude/get-shit-done/workflows/execute-plan.md
@/home/sqve/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-output-consistency/05-RESEARCH.md
@internal/logger/spinner.go
@internal/logger/format.go
@internal/styles/styles.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Improve remove command output with full path</name>
  <files>cmd/grove/commands/remove.go</files>
  <action>
Update remove.go to show full path and add spinner for multi-worktree removal.

1. **Full path in success messages (fixes #68):**

Change the success message to include directory name and full path:

```go
// Single removal - show directory name with path
dirName := filepath.Base(info.Path)
if deleteBranch {
    logger.Success("Removed worktree %s", styles.RenderPath(info.Path))
    logger.ListSubItem("deleted branch %s", info.Branch)
} else {
    logger.Success("Removed worktree %s", styles.RenderPath(info.Path))
}
```

For multi-removal, keep count but also log each:

```go
logger.Success("Removed %d worktrees", len(removed))
for _, path := range removed {
    logger.ListSubItem("%s", styles.RenderPath(path))
}
```

2. **Track paths instead of branch names:**

Change `removed` slice to store paths instead of branch names:

```go
removed = append(removed, info.Path)  // Was: removed = append(removed, info.Branch)
```

3. **Add spinner for multi-worktree removal:**

When removing multiple worktrees, show progress spinner:

```go
if len(unique) > 1 {
    spin := logger.StartSpinner(fmt.Sprintf("Removing worktrees (0/%d)...", len(unique)))
    defer spin.Stop()

    for i, info := range unique {
        spin.Update(fmt.Sprintf("Removing worktrees (%d/%d)...", i+1, len(unique)))
        // ... removal logic ...
    }
    spin.Stop()  // Explicit stop before success message
}
```

4. **Import styles package** if not already imported.
   </action>
   <verify>
   `grove remove feat-branch` shows "Removed worktree /full/path/to/feat-branch"
   `grove remove --branch feat` shows path and "deleted branch feat"
   `grove remove a b c` shows spinner with progress "Removing worktrees (1/3)..." and lists all paths
   </verify>
   <done>CLRT-01 satisfied: grove remove shows full path of deleted worktree (fixes #68)</done>
   </task>

<task type="auto">
  <name>Task 2: Add spinner to prune fetch operation</name>
  <files>cmd/grove/commands/prune.go</files>
  <action>
Replace logger.Info with spinner for the fetch operation in runPrune function.

Change:

```go
logger.Info("Fetching remote changes...")
if err := git.FetchPrune(bareDir); err != nil {
    logger.Warning("Failed to fetch: %v", err)
}
```

To:

```go
spin := logger.StartSpinner("Fetching remote changes...")
if err := git.FetchPrune(bareDir); err != nil {
    spin.Stop()  // Stop spinner before warning
    logger.Warning("Failed to fetch: %v", err)
} else {
    spin.Stop()  // Silent stop - prune output shows results
}
```

Note: Don't use StopWithSuccess here because the prune command will show its own results. The spinner is just for the fetch wait period.
</action>
<verify>
`grove prune` shows spinner during "Fetching remote changes..." instead of static message.
`grove prune --plain` shows "-> Fetching remote changes..." once.
</verify>
<done>SPIN-08 satisfied: grove prune shows spinner during fetch operation</done>
</task>

</tasks>

<verification>
- `make test` passes
- `make lint` passes
- Manual test: `grove remove worktree-name` shows full path
- Manual test: Create 3 temp worktrees, `grove remove a b c` shows progress spinner
- Manual test: `grove prune` shows spinner during fetch
</verification>

<success_criteria>

- [ ] CLRT-01: grove remove shows full path of deleted worktree
- [ ] SPIN-08: grove prune shows spinner during fetch
- [ ] Multi-worktree remove shows progress counter
- [ ] All tests pass
- [ ] No lint errors
      </success_criteria>

<output>
After completion, create `.planning/phases/05-output-consistency/05-02-SUMMARY.md`
</output>
